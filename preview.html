<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HA-Powercard v2.2.1 Preview</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #111;
      color: #e0e0e0;
      min-height: 100vh;
      padding: 24px;
    }
    
    .preview-header {
      text-align: center;
      margin-bottom: 32px;
    }
    
    .preview-header h1 {
      color: #f59e0b;
      font-size: 2rem;
      margin-bottom: 8px;
    }
    
    .preview-header p {
      color: #888;
    }
    
    .preview-header .version {
      display: inline-block;
      background: #f59e0b;
      color: #000;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 600;
      margin-left: 8px;
    }
    
    .preview-container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .controls {
      background: #1c1c1c;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
    }
    
    .controls h3 {
      margin-bottom: 16px;
      color: #f59e0b;
    }
    
    .control-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 16px;
    }
    
    .control-item {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .control-item label {
      font-size: 0.8rem;
      color: #888;
    }
    
    .control-item input[type="range"] {
      width: 100%;
      accent-color: #f59e0b;
    }
    
    .control-item .value {
      font-size: 0.85rem;
      color: #fff;
      font-family: monospace;
    }
    
    ha-powercard {
      display: block;
    }
    
    .features {
      background: #1c1c1c;
      border-radius: 12px;
      padding: 20px;
      margin-top: 24px;
    }
    
    .features h3 {
      color: #f59e0b;
      margin-bottom: 12px;
    }
    
    .features ul {
      list-style: none;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 8px;
    }
    
    .features li {
      padding: 4px 0;
      color: #ccc;
    }
    
    .features li::before {
      content: '✓ ';
      color: #22c55e;
    }
  </style>
</head>
<body>
  <div class="preview-header">
    <h1>⚡ HA-Powercard <span class="version">v2.2.1</span></h1>
    <p>Interactive preview - adjust sliders to simulate power values</p>
  </div>
  
  <div class="preview-container">
    <div class="controls">
      <h3>Simulate Power Values</h3>
      <div class="control-grid">
        <div class="control-item">
          <label>Solar Power</label>
          <input type="range" id="solar-slider" min="0" max="10000" value="3500">
          <span class="value" id="solar-value">3500 W</span>
        </div>
        <div class="control-item">
          <label>Grid Power</label>
          <input type="range" id="grid-slider" min="0" max="15000" value="2100">
          <span class="value" id="grid-value">2100 W</span>
        </div>
        <div class="control-item">
          <label>Main Breaker</label>
          <input type="range" id="main-slider" min="0" max="20000" value="5600">
          <span class="value" id="main-value">5600 W</span>
        </div>
        <div class="control-item">
          <label>Kitchen CB</label>
          <input type="range" id="cb1-slider" min="0" max="5000" value="1850">
          <span class="value" id="cb1-value">1850 W</span>
        </div>
        <div class="control-item">
          <label>Living Room CB</label>
          <input type="range" id="cb2-slider" min="0" max="3000" value="420">
          <span class="value" id="cb2-value">420 W</span>
        </div>
        <div class="control-item">
          <label>Bedrooms CB</label>
          <input type="range" id="cb3-slider" min="0" max="2000" value="180">
          <span class="value" id="cb3-value">180 W</span>
        </div>
      </div>
    </div>
    
    <ha-powercard id="powercard"></ha-powercard>
    
    <div class="features">
      <h3>v2.2.1 Features</h3>
      <ul>
        <li>Device panels below all breakers</li>
        <li>Energy values: Wh → kWh conversion</li>
        <li>Monitored vs Unmonitored totals</li>
        <li>Sub-device support (see Kitchen)</li>
        <li>Auto-scaling responsive layout</li>
        <li>Properly aligned device tables</li>
        <li>Hourly average tracking</li>
        <li>Click breakers to collapse/expand</li>
      </ul>
    </div>
  </div>

  <script src="dist/ha-powercard.js"></script>
  <script>
    // Simulated Home Assistant state
    const mockStates = {
      'sensor.solar_power': { state: '3500', attributes: { unit_of_measurement: 'W' } },
      'sensor.grid_power': { state: '2100', attributes: { unit_of_measurement: 'W' } },
      'sensor.main_power': { state: '5600', attributes: { unit_of_measurement: 'W' } },
      'sensor.main_energy': { state: '24500', attributes: { unit_of_measurement: 'Wh' } },
      'sensor.main_current': { state: '24.3', attributes: { unit_of_measurement: 'A' } },
      'sensor.kitchen_power': { state: '1850', attributes: { unit_of_measurement: 'W' } },
      'sensor.kitchen_energy': { state: '8200', attributes: { unit_of_measurement: 'Wh' } },
      'sensor.kitchen_current': { state: '8.0', attributes: { unit_of_measurement: 'A' } },
      'sensor.living_power': { state: '420', attributes: { unit_of_measurement: 'W' } },
      'sensor.living_energy': { state: '3100', attributes: { unit_of_measurement: 'Wh' } },
      'sensor.living_current': { state: '1.8', attributes: { unit_of_measurement: 'A' } },
      'sensor.bedroom_power': { state: '180', attributes: { unit_of_measurement: 'W' } },
      'sensor.bedroom_energy': { state: '1200', attributes: { unit_of_measurement: 'Wh' } },
      'sensor.bedroom_current': { state: '0.8', attributes: { unit_of_measurement: 'A' } },
      'sensor.fridge_power': { state: '120', attributes: { unit_of_measurement: 'W' } },
      'sensor.oven_power': { state: '1200', attributes: { unit_of_measurement: 'W' } },
      'sensor.oven_fan_power': { state: '45', attributes: { unit_of_measurement: 'W' } },
      'sensor.oven_light_power': { state: '15', attributes: { unit_of_measurement: 'W' } },
      'sensor.microwave_power': { state: '0', attributes: { unit_of_measurement: 'W' } },
      'sensor.tv_power': { state: '150', attributes: { unit_of_measurement: 'W' } },
      'sensor.soundbar_power': { state: '45', attributes: { unit_of_measurement: 'W' } },
      'sensor.subwoofer_power': { state: '30', attributes: { unit_of_measurement: 'W' } },
      'sensor.lamp_power': { state: '60', attributes: { unit_of_measurement: 'W' } },
      'sensor.hvac_power': { state: '2400', attributes: { unit_of_measurement: 'W' } },
      'sensor.hvac_energy': { state: '15600', attributes: { unit_of_measurement: 'Wh' } },
      'sensor.hvac_current': { state: '10.4', attributes: { unit_of_measurement: 'A' } },
      'sensor.garage_power': { state: '750', attributes: { unit_of_measurement: 'W' } },
      'sensor.garage_energy': { state: '4200', attributes: { unit_of_measurement: 'Wh' } },
      'sensor.garage_current': { state: '3.3', attributes: { unit_of_measurement: 'A' } }
    };
    
    const mockHass = {
      states: mockStates
    };
    
    const config = {
      title: 'Distribution Board',
      show_solar: true,
      show_grid: true,
      show_battery: false,
      accent_color: '#f59e0b',
      solar: {
        entity: 'sensor.solar_power',
        name: 'Solar'
      },
      grid: {
        entity: 'sensor.grid_power',
        name: 'Grid'
      },
      main_breaker: {
        name: 'Main CB',
        entity_power: 'sensor.main_power',
        entity_energy: 'sensor.main_energy',
        entity_current: 'sensor.main_current'
      },
      circuit_breakers: [
        {
          name: 'Kitchen',
          entity_power: 'sensor.kitchen_power',
          entity_energy: 'sensor.kitchen_energy',
          entity_current: 'sensor.kitchen_current',
          devices: [
            { name: 'Refrigerator', entity: 'sensor.fridge_power' },
            { 
              name: 'Oven', 
              entity: 'sensor.oven_power',
              sub_devices: [
                { name: 'Oven Fan', entity: 'sensor.oven_fan_power' },
                { name: 'Oven Light', entity: 'sensor.oven_light_power' }
              ]
            },
            { name: 'Microwave', entity: 'sensor.microwave_power' }
          ]
        },
        {
          name: 'Living Room',
          entity_power: 'sensor.living_power',
          entity_energy: 'sensor.living_energy',
          entity_current: 'sensor.living_current',
          devices: [
            { name: 'TV', entity: 'sensor.tv_power' },
            { 
              name: 'Soundbar', 
              entity: 'sensor.soundbar_power',
              sub_devices: [
                { name: 'Subwoofer', entity: 'sensor.subwoofer_power' }
              ]
            }
          ]
        },
        {
          name: 'Bedrooms',
          entity_power: 'sensor.bedroom_power',
          entity_energy: 'sensor.bedroom_energy',
          entity_current: 'sensor.bedroom_current',
          devices: [
            { name: 'Lamp', entity: 'sensor.lamp_power' }
          ]
        },
        {
          name: 'HVAC',
          entity_power: 'sensor.hvac_power',
          entity_energy: 'sensor.hvac_energy',
          entity_current: 'sensor.hvac_current'
        },
        {
          name: 'Garage',
          entity_power: 'sensor.garage_power',
          entity_energy: 'sensor.garage_energy',
          entity_current: 'sensor.garage_current'
        }
      ]
    };
    
    const card = document.getElementById('powercard');
    card.setConfig(config);
    card.hass = mockHass;
    
    // Slider controls
    function updateSlider(sliderId, entityId, valueId) {
      const slider = document.getElementById(sliderId);
      const valueEl = document.getElementById(valueId);
      
      slider.addEventListener('input', () => {
        const value = slider.value;
        valueEl.textContent = value + ' W';
        mockStates[entityId].state = value;
        card.hass = { ...mockHass };
      });
    }
    
    updateSlider('solar-slider', 'sensor.solar_power', 'solar-value');
    updateSlider('grid-slider', 'sensor.grid_power', 'grid-value');
    updateSlider('main-slider', 'sensor.main_power', 'main-value');
    updateSlider('cb1-slider', 'sensor.kitchen_power', 'cb1-value');
    updateSlider('cb2-slider', 'sensor.living_power', 'cb2-value');
    updateSlider('cb3-slider', 'sensor.bedroom_power', 'cb3-value');
    
    // Log averages when available
    window.addEventListener('ha-powercard-averages', (e) => {
      console.log('HA-Powercard Averages:', e.detail);
    });
  </script>
</body>
</html>
